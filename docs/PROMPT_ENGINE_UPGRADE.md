# PromptEngine 功能升级总结

## 🎯 升级内容

本次更新实现了**智能提示词引擎（PromptEngine）**，为 CodeWhisper 增加了持续学习用户习惯的能力。

## ✨ 新增功能

### 1. 智能提示词系统
- **自动学习**：系统自动追踪用户常用术语
- **动态优化**：提示词随用户习惯自动调整
- **频次统计**：记录每个术语的使用频次和最后使用时间

### 2. 用户个性化词库
- **自动增长**：检测到的高频术语自动加入用户词库
- **智能淘汰**：超过容量限制时自动淘汰低频术语
- **持久化存储**：用户习惯保存在 `config/user_dict.json`

### 3. 可配置架构
- **配置文件驱动**：所有参数通过配置文件控制
- **行业可迁移**：仅需修改配置即可切换行业领域
- **灵活扩展**：支持自定义词库和规则

## 📁 新增文件

```
CodeWhisper/
├── config/                         # 新增配置目录
│   ├── base_config.json           # 全局配置
│   ├── base_dict.json             # 通用术语库
│   └── user_dict.json             # 用户个性化词库
├── codewhisper/
│   └── prompt_engine.py           # 智能提示词引擎（新增）
├── docs/
│   └── PROMPT_ENGINE.md           # 详细文档（新增）
└── test_prompt_engine.py          # 测试脚本（新增）
```

## 🚀 工作原理

### 传统方式（旧版本）
```
固定提示词 → Whisper → 转录结果
```

### 智能方式（新版本）
```
用户说话 → Whisper转录 → 检测术语 → 更新词库 → 优化提示词
   ↑                                                   ↓
   └──────────── 下次使用优化后的提示词 ←─────────────────┘
```

## 📊 效果示例

### 初始状态
```
提示词：计算机行业从业者：提测、联调、排期、上线、复盘、接口、并发、缓存、数据库、日志。
```

### 使用一段时间后（用户经常说 Redis、Dubbo）
```
提示词：计算机行业从业者：提测、联调、排期、上线、复盘、Redis、Dubbo、接口、并发、缓存。
```

**结果：提示词自动适应用户习惯！** 🎉

## 💡 核心算法：5+5 策略

提示词由 **10 个术语** 组成：
- **5 个固定术语**：来自通用词库（base_dict），确保基础覆盖
- **5 个个性术语**：来自用户词库（user_dict），按频次排序

当某个术语被用户提到 ≥3 次时，自动进入提示词。

## 🔧 使用方法

### 查看统计信息
```bash
python cli.py --info
```

输出：
```
智能提示词引擎：
  通用术语数   : 15 条
  用户术语数   : 4 条
  有效术语数   : 2 条

当前提示词：
  计算机行业从业者：提测、联调、排期、上线、复盘、Redis、Dubbo、接口、并发、缓存。
```

### 测试学习功能
```bash
python test_prompt_engine.py
```

### 查看用户词库
```bash
cat config/user_dict.json
```

## 🎓 行业迁移

只需修改两个配置文件即可切换行业：

**1. 修改 `config/base_config.json`**
```json
{
  "prompt_prefix": "医疗行业从业者：",
  ...
}
```

**2. 修改 `config/base_dict.json`**
```json
{
  "terms": ["病历", "诊断", "处方", "会诊", ...]
}
```

**无需修改任何代码！**

## 📈 技术亮点

1. **零侵入式学习**：不影响现有转录流程
2. **实时优化**：每次转录后立即更新提示词
3. **自动维护**：用户词库自动增长和淘汰
4. **配置驱动**：所有参数可配置
5. **行业无关**：轻松迁移到其他领域

## 📝 配置参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `prompt_total_terms` | 提示词术语总数 | 10 |
| `prompt_base_terms` | 固定通用术语数 | 5 |
| `max_user_terms` | 用户词库最大容量 | 20 |
| `user_term_min_freq` | 进入提示词的最低频次 | 3 |

## 🔍 数据流转

```mermaid
graph LR
    A[用户说话] --> B[Whisper转录]
    B --> C[术语修正]
    C --> D[检测术语]
    D --> E[更新user_dict]
    E --> F[重建提示词]
    F --> G[下次转录使用]
    G --> B
```

## 🎉 升级成果

- ✅ 新增智能提示词引擎
- ✅ 新增用户习惯学习系统
- ✅ 新增可配置架构
- ✅ 新增行业迁移能力
- ✅ 向后兼容，不影响现有功能
- ✅ 完整文档和测试脚本

## 📚 相关文档

详细文档请查看：`docs/PROMPT_ENGINE.md`

---

**一句话总结：**
> CodeWhisper 现在能够自动学习用户习惯，动态优化 Whisper 提示词，越用越懂你！🚀
